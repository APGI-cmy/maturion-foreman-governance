name: YAML Validation

on:
  pull_request:
    paths:
      - '.github/workflows/**/*.yml'
      - '.github/workflows/**/*.yaml'
      - '.github/agents/**/*.md'
      - '.agent'
  push:
    branches:
      - main
    paths:
      - '.github/workflows/**/*.yml'
      - '.github/workflows/**/*.yaml'
      - '.github/agents/**/*.md'
      - '.agent'

permissions:
  contents: read

jobs:
  yamllint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install yamllint
        run: |
          pip install yamllint

      - name: Validate YAML syntax (warnings allowed)
        run: |
          set -euo pipefail
          targets=(.github/workflows/*.yml .github/agents/*.md .agent)
          output=$(yamllint -f parsable "${targets[@]}" || true)

          if [ -n "$output" ]; then
            echo "$output"
          fi

          if echo "$output" | grep -q '(syntax)'; then
            echo "❌ YAML syntax errors detected."
            echo "Fix command: yamllint --fix .github/agents/*.md"
            exit 1
          fi

          if [ -n "$output" ]; then
            echo "⚠️ yamllint reported style warnings (non-blocking)."
          else
            echo "✅ yamllint found no issues."
          fi
          echo "Fix command: yamllint --fix .github/agents/*.md"
