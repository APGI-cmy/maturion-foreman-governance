{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://maturion.io/schemas/governance-inventory.schema.json",
  "title": "Governance Inventory Schema",
  "description": "Schema for per-repository governance inventory tracking layered-down governance artifacts, gaps, and sync status",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "schema_version",
    "repository",
    "last_updated",
    "canonical_source",
    "agent_types",
    "governance_artifacts",
    "gap_summary"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Version of this schema (semantic versioning)",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },
    "repository": {
      "type": "object",
      "description": "Repository identification",
      "required": ["owner", "name", "type"],
      "properties": {
        "owner": {
          "type": "string",
          "description": "Repository owner (organization or user)",
          "examples": ["APGI-cmy"]
        },
        "name": {
          "type": "string",
          "description": "Repository name",
          "examples": ["office-app", "PartPulse", "R_Roster"]
        },
        "type": {
          "type": "string",
          "description": "Repository type",
          "enum": ["governance_canonical", "consumer_app", "consumer_platform"],
          "examples": ["consumer_app"]
        }
      }
    },
    "last_updated": {
      "type": "string",
      "description": "ISO 8601 timestamp of last inventory update",
      "format": "date-time",
      "examples": ["2026-02-04T13:30:00Z"]
    },
    "last_sync": {
      "type": "string",
      "description": "ISO 8601 timestamp of last sync with canonical governance",
      "format": "date-time",
      "examples": ["2026-02-04T10:00:00Z"]
    },
    "canonical_source": {
      "type": "object",
      "description": "Canonical governance repository details",
      "required": ["repository", "branch", "commit_sha"],
      "properties": {
        "repository": {
          "type": "string",
          "description": "Canonical governance repository",
          "examples": ["APGI-cmy/maturion-foreman-governance"]
        },
        "branch": {
          "type": "string",
          "description": "Canonical governance branch",
          "examples": ["main"]
        },
        "commit_sha": {
          "type": "string",
          "description": "Git commit SHA of last sync from canonical",
          "pattern": "^[0-9a-f]{40}$",
          "examples": ["a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"]
        },
        "matrix_version": {
          "type": "string",
          "description": "Version of GOVERNANCE_AGENT_REQUIREMENTS_MATRIX.md used",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "examples": ["1.0.0"]
        }
      }
    },
    "agent_types": {
      "type": "array",
      "description": "Agent types present in this repository",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "class", "contract_path", "status"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Agent type identifier",
            "enum": ["foreman", "builder", "governance-liaison", "governance-repo-administrator", "CodexAdvisor", "assurance"],
            "examples": ["governance-liaison"]
          },
          "class": {
            "type": "string",
            "description": "Agent class",
            "enum": ["overseer", "executor", "administrator", "validator"],
            "examples": ["administrator"]
          },
          "contract_path": {
            "type": "string",
            "description": "Path to agent contract file",
            "examples": [".github/agents/governance-liaison.agent.md"]
          },
          "status": {
            "type": "string",
            "description": "Agent operational status",
            "enum": ["active", "inactive", "planned", "deprecated"],
            "examples": ["active"]
          },
          "version": {
            "type": "string",
            "description": "Agent contract version",
            "examples": ["2.1.0"]
          },
          "last_validated": {
            "type": "string",
            "description": "ISO 8601 timestamp of last contract validation",
            "format": "date-time",
            "examples": ["2026-02-04T12:00:00Z"]
          }
        }
      }
    },
    "governance_artifacts": {
      "type": "array",
      "description": "Governance artifacts layered down to this repository",
      "items": {
        "type": "object",
        "required": ["id", "path", "status", "applicable_agents"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Governance artifact identifier",
            "examples": ["execution-bootstrap", "stop-and-fix", "agent-protection"]
          },
          "canonical_path": {
            "type": "string",
            "description": "Path in canonical governance repository",
            "examples": ["governance/canon/EXECUTION_BOOTSTRAP_PROTOCOL.md"]
          },
          "local_path": {
            "type": "string",
            "description": "Path in this repository (if layered down)",
            "examples": ["governance/canon/EXECUTION_BOOTSTRAP_PROTOCOL.md"]
          },
          "status": {
            "type": "string",
            "description": "Layer-down status",
            "enum": ["present", "missing", "outdated", "not_required"],
            "examples": ["present"]
          },
          "requirement_level": {
            "type": "string",
            "description": "Requirement level per GOVERNANCE_AGENT_REQUIREMENTS_MATRIX.md",
            "enum": ["mandatory", "recommended", "not_applicable"],
            "examples": ["mandatory"]
          },
          "applicable_agents": {
            "type": "array",
            "description": "Agent types this artifact applies to",
            "items": {
              "type": "string",
              "examples": ["foreman", "builder", "governance-liaison"]
            },
            "minItems": 0
          },
          "requires_locked_section": {
            "type": "boolean",
            "description": "Whether artifact requires LOCKED section in agent contract",
            "examples": [true]
          },
          "version": {
            "type": "string",
            "description": "Version of artifact (if versioned)",
            "examples": ["1.1.0"]
          },
          "last_synced": {
            "type": "string",
            "description": "ISO 8601 timestamp of last sync from canonical",
            "format": "date-time",
            "examples": ["2026-02-04T10:00:00Z"]
          },
          "canonical_hash": {
            "type": "string",
            "description": "SHA-256 hash of canonical artifact (for drift detection)",
            "pattern": "^[0-9a-f]{64}$",
            "examples": ["e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"]
          },
          "local_hash": {
            "type": "string",
            "description": "SHA-256 hash of local artifact (for drift detection)",
            "pattern": "^[0-9a-f]{64}$",
            "examples": ["e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"]
          },
          "drift_detected": {
            "type": "boolean",
            "description": "Whether drift detected between canonical and local",
            "examples": [false]
          }
        }
      }
    },
    "gap_summary": {
      "type": "object",
      "description": "Summary of governance gaps",
      "required": ["total_gaps", "mandatory_gaps", "recommended_gaps"],
      "properties": {
        "total_gaps": {
          "type": "integer",
          "description": "Total number of gaps detected",
          "minimum": 0,
          "examples": [0]
        },
        "mandatory_gaps": {
          "type": "integer",
          "description": "Number of missing mandatory artifacts",
          "minimum": 0,
          "examples": [0]
        },
        "recommended_gaps": {
          "type": "integer",
          "description": "Number of missing recommended artifacts",
          "minimum": 0,
          "examples": [0]
        },
        "outdated_count": {
          "type": "integer",
          "description": "Number of outdated artifacts",
          "minimum": 0,
          "examples": [0]
        },
        "drift_count": {
          "type": "integer",
          "description": "Number of artifacts with drift",
          "minimum": 0,
          "examples": [0]
        },
        "compliance_percentage": {
          "type": "number",
          "description": "Compliance percentage (0-100)",
          "minimum": 0,
          "maximum": 100,
          "examples": [100.0]
        },
        "last_gap_analysis": {
          "type": "string",
          "description": "ISO 8601 timestamp of last gap analysis",
          "format": "date-time",
          "examples": ["2026-02-04T13:30:00Z"]
        }
      }
    },
    "missing_artifacts": {
      "type": "array",
      "description": "List of missing mandatory/recommended artifacts",
      "items": {
        "type": "object",
        "required": ["id", "requirement_level", "applicable_agents"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Missing artifact identifier",
            "examples": ["agent-self-governance"]
          },
          "canonical_path": {
            "type": "string",
            "description": "Path in canonical repository",
            "examples": ["governance/canon/AGENT_SELF_GOVERNANCE_PROTOCOL.md"]
          },
          "requirement_level": {
            "type": "string",
            "enum": ["mandatory", "recommended"],
            "examples": ["mandatory"]
          },
          "applicable_agents": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "examples": [["foreman", "builder"]]
          },
          "requires_locked_section": {
            "type": "boolean",
            "examples": [true]
          },
          "impact": {
            "type": "string",
            "description": "Impact description of missing artifact",
            "examples": ["Agent cannot perform self-governance check"]
          },
          "remediation": {
            "type": "string",
            "description": "Remediation action required",
            "examples": ["Layer down from canonical via governance-liaison"]
          }
        }
      }
    },
    "agent_contract_gaps": {
      "type": "array",
      "description": "Gaps in agent contract bindings",
      "items": {
        "type": "object",
        "required": ["agent_id", "missing_bindings"],
        "properties": {
          "agent_id": {
            "type": "string",
            "description": "Agent type with gaps",
            "examples": ["governance-liaison"]
          },
          "contract_path": {
            "type": "string",
            "examples": [".github/agents/governance-liaison.agent.md"]
          },
          "missing_bindings": {
            "type": "array",
            "description": "Missing mandatory bindings",
            "items": {
              "type": "string"
            },
            "examples": [["agent-self-governance", "pre-work-protocol"]]
          },
          "missing_locked_sections": {
            "type": "array",
            "description": "Missing required LOCKED sections",
            "items": {
              "type": "string"
            },
            "examples": [["Pre-Job Self-Governance", "Zero-Warning Handover"]]
          },
          "remediation_required": {
            "type": "boolean",
            "description": "Whether immediate remediation required",
            "examples": [true]
          },
          "remediation_pr": {
            "type": "string",
            "description": "PR number if remediation in progress",
            "examples": ["#1234"]
          }
        }
      }
    },
    "validation_history": {
      "type": "array",
      "description": "History of validation executions",
      "items": {
        "type": "object",
        "required": ["timestamp", "validator", "status"],
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "examples": ["2026-02-04T13:30:00Z"]
          },
          "validator": {
            "type": "string",
            "description": "Who/what performed validation",
            "examples": ["governance-gap-analyzer.sh", "assurance-agent", "human-cs2"]
          },
          "status": {
            "type": "string",
            "enum": ["pass", "fail", "warnings"],
            "examples": ["pass"]
          },
          "gaps_found": {
            "type": "integer",
            "minimum": 0,
            "examples": [0]
          },
          "report_path": {
            "type": "string",
            "description": "Path to detailed validation report",
            "examples": ["governance/reports/gap-analysis-2026-02-04.md"]
          }
        }
      }
    },
    "remediation_plan": {
      "type": "object",
      "description": "Plan for addressing detected gaps",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["none_required", "planned", "in_progress", "blocked"],
          "examples": ["none_required"]
        },
        "priority": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"],
          "examples": ["high"]
        },
        "assigned_to": {
          "type": "string",
          "description": "Agent or human assigned to remediation",
          "examples": ["governance-liaison", "cs2"]
        },
        "target_completion": {
          "type": "string",
          "format": "date-time",
          "description": "Target completion timestamp",
          "examples": ["2026-02-10T00:00:00Z"]
        },
        "remediation_prs": {
          "type": "array",
          "description": "PRs addressing gaps",
          "items": {
            "type": "object",
            "properties": {
              "pr_number": {
                "type": "string",
                "examples": ["#1234"]
              },
              "pr_url": {
                "type": "string",
                "format": "uri",
                "examples": ["https://github.com/APGI-cmy/office-app/pull/1234"]
              },
              "status": {
                "type": "string",
                "enum": ["draft", "open", "merged", "closed"],
                "examples": ["open"]
              },
              "gaps_addressed": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "examples": [["agent-self-governance"]]
              }
            }
          }
        },
        "blockers": {
          "type": "array",
          "description": "Blockers preventing remediation",
          "items": {
            "type": "object",
            "properties": {
              "blocker_id": {
                "type": "string",
                "examples": ["BLOCKER-001"]
              },
              "description": {
                "type": "string",
                "examples": ["Awaiting CS2 approval for agent contract modification"]
              },
              "escalated_to": {
                "type": "string",
                "examples": ["cs2", "johan-ras"]
              }
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "generated_by": {
          "type": "string",
          "description": "Tool or agent that generated this inventory",
          "examples": ["governance-gap-analyzer.sh v1.0.0"]
        },
        "manual_overrides": {
          "type": "array",
          "description": "Manual overrides to automated detection",
          "items": {
            "type": "object",
            "properties": {
              "artifact_id": {
                "type": "string"
              },
              "override_reason": {
                "type": "string"
              },
              "approved_by": {
                "type": "string"
              },
              "override_date": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        },
        "notes": {
          "type": "string",
          "description": "Free-form notes",
          "examples": ["Bootstrap phase - CS2 manual fixes pending"]
        }
      }
    }
  }
}
